<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <title>bad apple üçè</title>

    <style>
        input[type="checkbox"]:checked {
            outline: 2px solid black;
        }
    </style>

    <script>
        function set(id, state) {
            document.getElementById(id).checked = state;
        }

        function toggle(id) {
            if (document.getElementById(id).checked) {
                document.getElementById(id).checked = false;
            }
            else {
                document.getElementById(id).checked = true;
            }
        }

        function uncheckAll() {
            for (var i = 0; i < document.getElementsByTagName("input").length; i++) {
                document.getElementsByTagName("input")[i].checked = false;
            }
        }
    </script>
    <script src='frames.js'></script>
</head>

<body onload="uncheckAll();">
    <div style="background-color: white;">
        <div style="padding: 1%;">
            <center id='boxes'> </center>
        </div>
        <center>
            <button onclick="start();">start</button>

            <br />
            <br />
            <audio id="audio" controls>
                <source src="badapple.mp3" type="audio/mpeg">
            </audio>

            <br />
            <br />
            <footer>
                <h3><a href="https://github.com/bewuwy/bad-apple-checkbox">github repo</a></h3>
            </footer>
        </center>
    </div>
</body>

<script>
    // Build the checkboxes dynamically.
    const height = frames[0].length;
    const width = frames[0][0].length;

    for (let y = 0; y < height; y++) {
        const div = document.createElement('div');
        for (let x = 0; x < width; x++) {
            const box = document.createElement('input');
            box.id = `${y}-${x}`;
            box.type = 'checkbox';
            div.appendChild(box);
        }

        document.getElementById('boxes').appendChild(div);
    }

</script>

<script>
    let timeouts = [];

    function start() {
        for (const timeout of timeouts)
            clearTimeout(timeout);

        uncheckAll();


        for (let i = 0; i < frames.length; i++) {
            ((frame, prevFrame, index) => {
                if (frame != prevFrame)
                    timeouts.push(setTimeout(() => {
                        console.log(index);
                        for (let y = 0; y < frame.length; y++) {
                            for (let x = 0; x < frame[y].length; x++) {
                                if (!prevFrame)
                                    set(`${y}-${x}`, !!frame[y][x]);
                                else
                                    if (prevFrame[y][x] != frame[y][x])
                                        set(`${y}-${x}`, !!frame[y][x]);

                            }
                        }
                    }, (1000 / 20) * index));
            })(frames[i], frames[i - 1], i);
        }
        document.getElementById('audio').currentTime = 0;
        document.getElementById('audio').play();
    }

</script>

</html>